<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Hand Tracked ‚Äî Perkenalan Diri</title>

<!-- Preconnect: mulai koneksi lebih awal -->
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="preconnect" href="https://storage.googleapis.com">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- Preload model & WASM (mulai download sebelum JS jalan) -->
<link rel="preload" as="fetch" crossorigin href="https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm/vision_wasm_internal.wasm">
<link rel="preload" as="fetch" crossorigin href="https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">

<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #050810;
    --accent: #00f5ff;
    --accent2: #ff006e;
    --accent3: #7b2fff;
    --text: #e8f4f8;
    --dim: rgba(232, 244, 248, 0.4);
    --grid: rgba(0, 245, 255, 0.04);
  }

  html, body {
    width: 100%; height: 100%;
    overflow: hidden;
    font-family: 'Syne', sans-serif;
    background: var(--bg);
    color: var(--text);
  }

  body::before {
    content: '';
    position: fixed; inset: 0; z-index: 0;
    background-image:
      linear-gradient(var(--grid) 1px, transparent 1px),
      linear-gradient(90deg, var(--grid) 1px, transparent 1px);
    background-size: 40px 40px;
  }

  .orb {
    position: fixed; border-radius: 50%; filter: blur(80px); z-index: 0; pointer-events: none;
  }
  .orb1 { width: 400px; height: 400px; background: rgba(0,245,255,0.08); top:-100px; left:-100px; }
  .orb2 { width: 350px; height: 350px; background: rgba(255,0,110,0.07); bottom:-80px; right:-80px; }
  .orb3 { width: 300px; height: 300px; background: rgba(123,47,255,0.06); top:50%; left:50%; transform:translate(-50%,-50%); }

  /* ‚îÄ‚îÄ Camera corner ‚îÄ‚îÄ */
  #videoContainer {
    position: fixed; top: 16px; right: 16px; z-index: 100;
    width: 90px; height: 120px;
    border-radius: 14px; overflow: hidden;
    border: 1px solid rgba(0,245,255,0.3);
    box-shadow: 0 0 20px rgba(0,245,255,0.2);
    display: none;
  }
  #inputVideo {
    width: 100%; height: 100%;
    object-fit: cover; transform: scaleX(-1); display: block;
  }
  #handCanvas {
    position: absolute; inset: 0;
    width: 100%; height: 100%;
    transform: scaleX(-1);
  }

  /* ‚îÄ‚îÄ Slides ‚îÄ‚îÄ */
  #app {
    position: fixed; inset: 0; z-index: 10;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 24px 24px 100px; gap: 20px;
  }

  .slide { display: none; flex-direction: column; align-items: center; text-align: center; gap: 16px; animation: fadeSlide .5s ease; max-width: 500px; width: 100%; }
  .slide.active { display: flex; }

  @keyframes fadeSlide {
    from { opacity: 0; transform: translateY(20px) scale(.97); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }

  .slide-tag {
    display: inline-flex; align-items: center; gap: 8px;
    background: rgba(0,245,255,0.08); border: 1px solid rgba(0,245,255,0.2);
    border-radius: 99px; padding: 6px 16px;
    font-size: 12px; color: var(--accent);
    font-family: 'Space Mono', monospace; letter-spacing: 1px;
  }

  .slide h1 {
    font-size: clamp(28px,8vw,48px); font-weight: 800; line-height: 1.1;
    background: linear-gradient(135deg, #fff 0%, var(--accent) 60%, var(--accent3) 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  }
  .slide h2 { font-size: clamp(22px,6vw,36px); font-weight: 700; color: var(--accent); }
  .slide p { font-size: clamp(14px,3.5vw,17px); color: var(--dim); line-height: 1.7; max-width: 380px; }

  .card-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 10px; width: 100%; max-width: 380px; }
  .mini-card { background: rgba(0,245,255,0.05); border: 1px solid rgba(0,245,255,0.15); border-radius: 12px; padding: 14px; text-align: left; }
  .mini-card .label { font-family: 'Space Mono', monospace; font-size: 9px; letter-spacing: 2px; color: var(--accent); margin-bottom: 4px; text-transform: uppercase; }
  .mini-card .val { font-size: 14px; font-weight: 700; color: var(--text); }

  .skill-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; }
  .skill-pill { background: rgba(123,47,255,0.12); border: 1px solid rgba(123,47,255,0.3); border-radius: 99px; padding: 6px 14px; color: #c0aaff; font-family: 'Space Mono', monospace; font-size: 11px; }

  .big-emoji { font-size: clamp(50px,14vw,80px); line-height: 1; filter: drop-shadow(0 0 20px rgba(0,245,255,0.4)); }

  /* ‚îÄ‚îÄ Profile Photo ‚îÄ‚îÄ */
  .profile-photo-wrap {
    position: relative;
    width: clamp(110px, 30vw, 150px);
    height: clamp(110px, 30vw, 150px);
  }
  .profile-photo {
    width: 100%; height: 100%;
    object-fit: cover; border-radius: 50%;
    border: 2px solid var(--accent);
    box-shadow: 0 0 0 4px rgba(0,245,255,0.12), 0 0 30px rgba(0,245,255,0.3);
    display: block;
  }
  .profile-photo-wrap::before {
    content: '';
    position: absolute; inset: -5px;
    border-radius: 50%;
    border: 2px solid transparent;
    border-top-color: var(--accent);
    border-right-color: var(--accent3);
    animation: spinRing 3s linear infinite;
  }
  @keyframes spinRing { to { transform: rotate(360deg); } }
  .photo-fallback {
    display: none; width: 100%; height: 100%;
    border-radius: 50%; background: rgba(0,245,255,0.06);
    border: 2px dashed rgba(0,245,255,0.3);
    align-items: center; justify-content: center;
    font-size: 40px;
  }

  /* ‚îÄ‚îÄ Dots ‚îÄ‚îÄ */
  #dots { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; z-index: 20; }
  .dot { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,0.2); transition: all .3s; cursor: pointer; }
  .dot.active { background: var(--accent); box-shadow: 0 0 12px var(--accent); width: 24px; border-radius: 4px; }

  /* ‚îÄ‚îÄ Gesture HUD ‚îÄ‚îÄ */
  #gestureHUD {
    position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%); z-index: 30;
    background: rgba(5,8,16,0.85); border: 1px solid rgba(0,245,255,0.2);
    border-radius: 99px; padding: 8px 20px;
    font-family: 'Space Mono', monospace; font-size: 11px; color: var(--accent); letter-spacing: 1px;
    white-space: nowrap; display: none; align-items: center; gap: 8px; transition: opacity .3s;
  }
  .hud-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent); animation: pulse 1.5s infinite; }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.7)} }

  /* ‚îÄ‚îÄ Gesture Feedback ‚îÄ‚îÄ */
  #gestureFeedback { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); z-index: 50; font-size: 60px; pointer-events: none; opacity: 0; }
  #gestureFeedback.show { animation: popIn .5s ease forwards; }
  @keyframes popIn {
    0%   { opacity:1; transform:translate(-50%,-50%) scale(.5); }
    50%  { opacity:1; transform:translate(-50%,-50%) scale(1.3); }
    100% { opacity:0; transform:translate(-50%,-50%) scale(1); }
  }

  /* ‚îÄ‚îÄ Loading ‚îÄ‚îÄ */
  #loading {
    position: fixed; inset: 0; z-index: 200;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    background: var(--bg); gap: 20px; padding: 40px;
  }
  #loading h2 { font-size: 16px; font-weight: 700; color: var(--accent); font-family: 'Space Mono', monospace; letter-spacing: 2px; }
  #loading p { font-size: 12px; color: var(--dim); font-family: 'Space Mono', monospace; text-align: center; }

  /* Progress bar */
  .progress-wrap {
    width: 260px;
    background: rgba(0,245,255,0.08);
    border: 1px solid rgba(0,245,255,0.2);
    border-radius: 99px;
    padding: 3px;
    overflow: hidden;
  }
  .progress-bar {
    height: 6px; border-radius: 99px;
    background: linear-gradient(90deg, var(--accent3), var(--accent));
    width: 0%;
    transition: width .4s ease;
    box-shadow: 0 0 12px var(--accent);
  }

  /* Progress steps */
  .steps {
    display: flex; flex-direction: column; gap: 8px;
    width: 100%; max-width: 260px;
  }
  .step {
    display: flex; align-items: center; gap: 10px;
    font-family: 'Space Mono', monospace; font-size: 11px;
    color: rgba(232,244,248,0.25); transition: color .3s;
  }
  .step.done { color: var(--accent); }
  .step.active { color: var(--text); }
  .step-dot {
    width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
    background: rgba(0,245,255,0.2); transition: all .3s;
  }
  .step.done  .step-dot { background: var(--accent); box-shadow: 0 0 8px var(--accent); }
  .step.active .step-dot { background: #fff; animation: pulse 1s infinite; }

  /* Cache badge */
  #cacheBadge {
    display: none; align-items: center; gap: 6px;
    background: rgba(0,245,255,0.08); border: 1px solid rgba(0,245,255,0.25);
    border-radius: 99px; padding: 6px 14px;
    font-family: 'Space Mono', monospace; font-size: 10px; color: var(--accent); letter-spacing: 1px;
  }
  #cacheBadge.show { display: flex; }

  /* ‚îÄ‚îÄ Guide ‚îÄ‚îÄ */
  #guide {
    position: fixed; inset: 0; z-index: 150;
    background: rgba(5,8,16,0.96);
    display: none; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 20px; padding: 32px;
  }
  #guide h2 { font-size: 22px; font-weight: 800; background: linear-gradient(135deg,#fff,var(--accent)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
  .gesture-guide { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; width: 100%; max-width: 380px; }
  .gg-card { background: rgba(0,245,255,0.05); border: 1px solid rgba(0,245,255,0.15); border-radius: 14px; padding: 14px 10px; text-align: center; display: flex; flex-direction: column; gap: 6px; align-items: center; }
  .gg-card .gg-emoji { font-size: 28px; }
  .gg-card .gg-label { font-family: 'Space Mono', monospace; font-size: 9px; color: var(--accent); letter-spacing: 1px; text-transform: uppercase; }
  .gg-card .gg-desc { font-size: 11px; color: var(--dim); line-height: 1.4; }
  .start-btn { background: var(--accent); color: var(--bg); border: none; cursor: pointer; font-family: 'Syne', sans-serif; font-weight: 800; font-size: 15px; padding: 14px 40px; border-radius: 99px; letter-spacing: 1px; box-shadow: 0 0 30px rgba(0,245,255,0.4); transition: transform .2s; }
  .start-btn:active { transform: scale(.95); }
</style>
</head>
<body>

<div class="orb orb1"></div>
<div class="orb orb2"></div>
<div class="orb orb3"></div>

<!-- ‚îÄ‚îÄ Loading ‚îÄ‚îÄ -->
<div id="loading">
  <div id="cacheBadge">‚ö° CACHE AKTIF ‚Äî MEMUAT INSTAN</div>
  <h2>MEMUAT MEDIAPIPE</h2>

  <div class="progress-wrap">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <div class="steps">
    <div class="step" id="step0"><div class="step-dot"></div>Inisialisasi runtime...</div>
    <div class="step" id="step1"><div class="step-dot"></div>Memuat model WASM...</div>
    <div class="step" id="step2"><div class="step-dot"></div>Download model tangan...</div>
    <div class="step" id="step3"><div class="step-dot"></div>Siap!</div>
  </div>

  <p id="loadingTip">Pertama kali mungkin 10‚Äì20 detik.<br>Berikutnya akan <strong style="color:var(--accent)">instan</strong> karena cache üöÄ</p>
</div>

<!-- ‚îÄ‚îÄ Guide ‚îÄ‚îÄ -->
<div id="guide">
  <div class="slide-tag">‚úã Cara Kontrol Gestur</div>
  <h2>Kendalikan dengan Tangan</h2>
  <div class="gesture-guide" style="grid-template-columns:repeat(3,1fr);gap:10px;width:100%;max-width:400px">
    <div class="gg-card"><div class="gg-emoji">üñêÔ∏è</div><div class="gg-label">HALO</div><div class="gg-desc">Semua 5 jari terbuka</div></div>
    <div class="gg-card"><div class="gg-emoji">‚òùÔ∏è</div><div class="gg-label">TENTANG SAYA</div><div class="gg-desc">Telunjuk saja</div></div>
    <div class="gg-card"><div class="gg-emoji">‚úåÔ∏è</div><div class="gg-label">PENDIDIKAN</div><div class="gg-desc">Telunjuk + Tengah</div></div>
    <div class="gg-card"><div class="gg-emoji">ü§ü</div><div class="gg-label">KEAHLIAN</div><div class="gg-desc">+ Manis</div></div>
    <div class="gg-card"><div class="gg-emoji">üññ</div><div class="gg-label">MARI TERHUBUNG</div><div class="gg-desc">+ Kelingking</div></div>
    <div class="gg-card" style="background:rgba(255,0,110,0.08);border-color:rgba(255,0,110,0.2)"><div class="gg-emoji">‚è±Ô∏è</div><div class="gg-label" style="color:#ff006e">TAHAN</div><div class="gg-desc" style="color:#ff006e">0.8 detik</div></div>
  </div>
  <p style="font-size:12px;color:var(--dim);font-family:'Space Mono',monospace;text-align:center;max-width:300px">
    Tambah jari bertahap. Tahan tiap gestur 0.8 detik agar slide berpindah.
  </p>
  <button class="start-btn" onclick="startTracking()">üöÄ Mulai</button>
</div>

<!-- ‚îÄ‚îÄ Camera ‚îÄ‚îÄ -->
<div id="videoContainer">
  <video id="inputVideo" autoplay muted playsinline></video>
  <canvas id="handCanvas"></canvas>
</div>

<div id="gestureFeedback"></div>

<!-- ‚îÄ‚îÄ Slides ‚îÄ‚îÄ -->
<div id="app">
  <div class="slide active" id="slide-0">
    <div class="profile-photo-wrap">
      <!-- Ganti src di bawah dengan link foto kamu -->
      <img src="owi.jpg" alt="Foto Dandy Ahmad" class="profile-photo" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
      <div class="photo-fallback">üì∑</div>
    </div>
    <div class="slide-tag">Slide 01 / 05</div>
    <h1>Halo, Saya<br>Dandy Ahmad!</h1>
    <p>Saya adalah siswa SMKN 67 Jakarta.<br>Kendalikan presentasi ini <strong style="color:var(--accent)">hanya dengan tangan</strong>.</p>
  </div>

  <div class="slide" id="slide-1">
    <div class="slide-tag">Slide 02 / 05</div>
    <h2>Tentang Saya</h2>
    <div class="card-grid">
      <div class="mini-card"><div class="label">Nama</div><div class="val">Dandy Ahmad</div></div>
      <div class="mini-card"><div class="label">Usia</div><div class="val">## Tahun</div></div>
      <div class="mini-card"><div class="label">Asal</div><div class="val">Jakarta, ID</div></div>
      <div class="mini-card"><div class="label">Status</div><div class="val">Siswa</div></div>
    </div>
    <p>Seorang siswa yang bersemangat membangun solusi digital kreatif.</p>
  </div>

  <div class="slide" id="slide-2">
    <div class="slide-tag">Slide 03 / 05</div>
    <h2>Pendidikan</h2>
    <div class="big-emoji" style="font-size:48px">üèõÔ∏è</div>
    <div class="card-grid">
      <div class="mini-card" style="grid-column:1/-1"><div class="label">Sekolah</div><div class="val">SMK Negeri 67 Jakarta</div></div>
      <div class="mini-card"><div class="label">Jurusan</div><div class="val">Animasi</div></div>
      <div class="mini-card"><div class="label">Angkatan</div><div class="val">2027</div></div>
    </div>
  </div>

  <div class="slide" id="slide-3">
    <div class="slide-tag">Slide 04 / 05</div>
    <h2>Keahlian</h2>
    <div class="skill-list">
      <span class="skill-pill">React</span><span class="skill-pill">Python</span>
      <span class="skill-pill">Machine Learning</span><span class="skill-pill">MediaPipe</span>
      <span class="skill-pill">Node.js</span><span class="skill-pill">EMEL</span>
      <span class="skill-pill">EPEP</span><span class="skill-pill">Git</span>
    </div>
    <p>Fokus di bidang Web Development.</p>
  </div>

  <div class="slide" id="slide-4">
    <div class="profile-photo-wrap">
    <img src="owi.jpg" alt="Foto Dandy Ahmad" class="profile-photo" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
    <div class="photo-fallback">üì∑</div>
    <div class="slide-tag">Slide 05 / 05</div>
    <h1>Mari Terhubung!</h1>
    <div class="card-grid" style="max-width:320px">
      <div class="mini-card"><div class="label">Email</div><div class="val" style="font-size:12px">dandyahmad139@gmail.com</div></div>
      <div class="mini-card"><div class="label">GitHub</div><div class="val" style="font-size:12px">@dandyycihuyy</div></div>
      <div class="mini-card" style="grid-column:1/-1"><div class="label">LinkedIn</div><div class="val" style="font-size:12px">linkedin.com/in/bimadev</div></div>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ Dots ‚îÄ‚îÄ -->
<div id="dots">
  <div class="dot active" onclick="goTo(0)"></div>
  <div class="dot" onclick="goTo(1)"></div>
  <div class="dot" onclick="goTo(2)"></div>
  <div class="dot" onclick="goTo(3)"></div>
  <div class="dot" onclick="goTo(4)"></div>
</div>

<!-- ‚îÄ‚îÄ HUD ‚îÄ‚îÄ -->
<div id="gestureHUD">
  <div class="hud-dot"></div>
  <span id="hudText">Arahkan tangan ke kamera</span>
</div>

<script type="module">
/* ‚îÄ‚îÄ Service Worker Registration ‚îÄ‚îÄ */
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js').catch(() => {});
}

/* ‚îÄ‚îÄ Progress UI helpers ‚îÄ‚îÄ */
const bar   = document.getElementById('progressBar');
const steps = ['step0','step1','step2','step3'];

function setProgress(pct, stepIdx) {
  bar.style.width = pct + '%';
  steps.forEach((id, i) => {
    const el = document.getElementById(id);
    el.className = 'step ' + (i < stepIdx ? 'done' : i === stepIdx ? 'active' : '');
  });
}

/* ‚îÄ‚îÄ Check SW cache ‚îÄ‚îÄ */
async function isCached() {
  try {
    const c = await caches.open('handtracked-v1');
    const r = await c.match('https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm/vision_wasm_internal.wasm');
    return !!r;
  } catch { return false; }
}

/* ‚îÄ‚îÄ Slide navigation ‚îÄ‚îÄ */
const TOTAL = 5;
let current = 0;
window.goTo = function(i) {
  if (i < 0 || i >= TOTAL) return;
  document.getElementById('slide-' + current).classList.remove('active');
  current = i;
  document.getElementById('slide-' + current).classList.add('active');
  document.querySelectorAll('.dot').forEach((d, idx) => d.classList.toggle('active', idx === current));
};

function showFeedback(emoji) {
  const el = document.getElementById('gestureFeedback');
  el.textContent = emoji;
  el.classList.remove('show');
  void el.offsetWidth;
  el.classList.add('show');
}

/* ‚îÄ‚îÄ Gesture detection ‚îÄ‚îÄ */
let lastGesture = null, gestureStartTime = 0, gestureTriggered = false, cooldown = false;
const HOLD_MS = 800;

function detectFingers(lm) {
  return [
    lm[4].x > lm[3].x,         // thumb
    lm[8].y  < lm[6].y,        // index
    lm[12].y < lm[10].y,       // middle
    lm[16].y < lm[14].y,       // ring
    lm[20].y < lm[18].y,       // pinky
  ];
}

function classifyGesture(ext) {
  const [thumb, idx, mid, ring, pink] = ext;
  if (thumb && idx && mid && ring && pink) return 'FIVE';
  if (idx && mid && ring && pink)          return 'FOUR';
  if (idx && mid && ring && !pink)         return 'THREE';
  if (idx && mid && !ring)                 return 'TWO';
  if (idx && !mid)                         return 'ONE';
  return 'OTHER';
}

function handleGesture(gesture) {
  if (cooldown || gesture === 'OTHER') return;
  const now = Date.now();
  if (gesture !== lastGesture) { lastGesture = gesture; gestureStartTime = now; gestureTriggered = false; return; }
  if (!gestureTriggered && (now - gestureStartTime) >= HOLD_MS) {
    gestureTriggered = true;
    cooldown = true;
    setTimeout(() => cooldown = false, 1200);
    const map = { FIVE:{s:0,e:'üñêÔ∏è'}, ONE:{s:1,e:'‚òùÔ∏è'}, TWO:{s:2,e:'‚úåÔ∏è'}, THREE:{s:3,e:'ü§ü'}, FOUR:{s:4,e:'üññ'} };
    if (map[gesture]) { showFeedback(map[gesture].e); goTo(map[gesture].s); }
  }
}

/* ‚îÄ‚îÄ MediaPipe Tasks Vision (new fast API) ‚îÄ‚îÄ */
let handLandmarker = null;

async function loadMediaPipe() {
  const cached = await isCached();
  if (cached) {
    document.getElementById('cacheBadge').classList.add('show');
    document.getElementById('loadingTip').innerHTML = '‚ö° Cache aktif ‚Äî dimuat dari penyimpanan lokal';
  }

  setProgress(10, 0);

  // Import Tasks Vision (jauh lebih cepat dari @mediapipe/hands lama)
  const { HandLandmarker, FilesetResolver } =
    await import('https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/vision_bundle.mjs');

  setProgress(40, 1);

  const vision = await FilesetResolver.forVisionTasks(
    'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm'
  );

  setProgress(65, 2);

  handLandmarker = await HandLandmarker.createFromOptions(vision, {
    baseOptions: {
      modelAssetPath: 'https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task',
      delegate: 'GPU'  // gunakan GPU jika tersedia
    },
    numHands: 1,
    runningMode: 'VIDEO'
  });

  setProgress(100, 3);
  await new Promise(r => setTimeout(r, 500));

  // Sembunyikan loading, tampilkan guide
  document.getElementById('loading').style.display = 'none';
  document.getElementById('guide').style.display = 'flex';
}

/* ‚îÄ‚îÄ Start tracking after user clicks Mulai ‚îÄ‚îÄ */
window.startTracking = async function() {
  document.getElementById('guide').style.display = 'none';
  document.getElementById('videoContainer').style.display = 'block';
  document.getElementById('gestureHUD').style.display = 'flex';

  const video   = document.getElementById('inputVideo');
  const canvas  = document.getElementById('handCanvas');
  const ctx     = canvas.getContext('2d');
  const hudText = document.getElementById('hudText');

  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: 'user', width: { ideal: 320 }, height: { ideal: 240 } },
    audio: false
  }).catch(() => null);

  if (!stream) { hudText.textContent = '‚ö†Ô∏è Kamera tidak bisa diakses'; return; }
  video.srcObject = stream;
  await new Promise(r => video.onloadeddata = r);

  const hudMap = { FIVE:'üñêÔ∏è Halo!', ONE:'‚òùÔ∏è Tentang Saya', TWO:'‚úåÔ∏è Pendidikan', THREE:'ü§ü Keahlian', FOUR:'üññ Mari Terhubung', OTHER:'ü§î Coba lagi...' };

  let lastVideoTime = -1;

  function detect() {
    if (video.currentTime !== lastVideoTime) {
      lastVideoTime = video.currentTime;

      canvas.width  = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const result = handLandmarker.detectForVideo(video, performance.now());

      if (result.landmarks && result.landmarks.length > 0) {
        const lm = result.landmarks[0];
        const ext = detectFingers(lm);
        const g = classifyGesture(ext);

        hudText.textContent = hudMap[g] || 'Deteksi...';

        // Draw skeleton
        ctx.strokeStyle = '#00f5ff'; ctx.lineWidth = 1.5; ctx.fillStyle = '#ff006e';
        const conns = [[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],[0,17],[17,18],[18,19],[19,20],[5,9],[9,13],[13,17]];
        conns.forEach(([a,b]) => {
          ctx.beginPath();
          ctx.moveTo(lm[a].x*canvas.width, lm[a].y*canvas.height);
          ctx.lineTo(lm[b].x*canvas.width, lm[b].y*canvas.height);
          ctx.stroke();
        });
        lm.forEach(p => {
          ctx.beginPath(); ctx.arc(p.x*canvas.width, p.y*canvas.height, 2, 0, Math.PI*2); ctx.fill();
        });

        handleGesture(g);
      } else {
        hudText.textContent = 'Arahkan tangan ke kamera';
        lastGesture = null; gestureTriggered = false;
      }
    }
    requestAnimationFrame(detect);
  }
  detect();
};

/* ‚îÄ‚îÄ Touch swipe fallback ‚îÄ‚îÄ */
let tx = 0;
document.addEventListener('touchstart', e => tx = e.touches[0].clientX, { passive: true });
document.addEventListener('touchend',   e => { const dx = e.changedTouches[0].clientX - tx; if (Math.abs(dx) > 60) dx < 0 ? goTo(current+1) : goTo(current-1); }, { passive: true });

/* ‚îÄ‚îÄ Boot ‚îÄ‚îÄ */
loadMediaPipe();
</script>
</body>
</html>
